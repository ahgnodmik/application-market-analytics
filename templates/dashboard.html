{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
    <div>
        <h2 class="text-3xl font-bold text-notion-text mb-2">대시보드</h2>
        <p class="text-notion-textLight">앱 마켓 분석 현황을 한눈에 확인하세요</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white border border-notion-border rounded-lg p-6 hover:shadow-md transition-shadow">
            <h3 class="text-sm font-medium text-notion-textLight mb-2">총 앱 수</h3>
            <p class="text-3xl font-bold text-notion-text" id="total-apps">-</p>
        </div>
        <div class="bg-white border border-notion-border rounded-lg p-6 hover:shadow-md transition-shadow">
            <h3 class="text-sm font-medium text-notion-textLight mb-2">추천 타입 수</h3>
            <p class="text-3xl font-bold text-notion-blue" id="recommended-types">-</p>
        </div>
        <div class="bg-white border border-notion-border rounded-lg p-6 hover:shadow-md transition-shadow">
            <h3 class="text-sm font-medium text-notion-textLight mb-2">평균 난이도</h3>
            <p class="text-3xl font-bold text-notion-text" id="avg-difficulty">-</p>
        </div>
        <div class="bg-white border border-notion-border rounded-lg p-6 hover:shadow-md transition-shadow">
            <h3 class="text-sm font-medium text-notion-textLight mb-2">평균 시장성</h3>
            <p class="text-3xl font-bold text-green-600" id="avg-marketability">-</p>
        </div>
    </div>
    
    <div class="bg-white border border-notion-border rounded-lg p-6">
        <h3 class="text-xl font-semibold text-notion-text mb-4">빠른 작업</h3>
        <div class="flex gap-3">
            <a href="/apps" class="px-4 py-2 bg-notion-blue text-white rounded-md hover:bg-blue-600 transition-colors">
                앱 추가
            </a>
            <a href="/analysis" class="px-4 py-2 bg-white border border-notion-border text-notion-text rounded-md hover:bg-notion-sidebar transition-colors">
                분석 보기
            </a>
            <a href="/report" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                AI 리포트 생성
            </a>
        </div>
    </div>
    
    <div class="bg-white border border-notion-border rounded-lg p-6">
        <h3 class="text-xl font-semibold text-notion-text mb-4">추천 앱 타입 (최근 5개)</h3>
        <div id="recommendations-list" class="space-y-4">
            <p class="text-notion-textLight">로딩 중...</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    // 통계 로드
    try {
        const appsRes = await fetch('/api/apps/');
        const apps = await appsRes.json();
        
        document.getElementById('total-apps').textContent = apps.length;
        
        if (apps.length > 0) {
            const avgDifficulty = (apps.reduce((sum, a) => sum + a.difficulty_score, 0) / apps.length).toFixed(2);
            const avgMarketability = (apps.reduce((sum, a) => sum + a.marketability_score, 0) / apps.length).toFixed(2);
            
            document.getElementById('avg-difficulty').textContent = avgDifficulty;
            document.getElementById('avg-marketability').textContent = avgMarketability;
        }
        
        // 추천 타입 로드
        const recRes = await fetch('/api/analysis/recommendations?min_marketability=6&max_difficulty=1.0&max_features=5');
        const recommendations = await recRes.json();
        
        document.getElementById('recommended-types').textContent = recommendations.length;
        
        // 추천 목록 표시
        const listEl = document.getElementById('recommendations-list');
        if (recommendations.length === 0) {
            listEl.innerHTML = '<p class="text-notion-textLight">추천 항목이 없습니다. 앱을 추가하고 분석해보세요.</p>';
        } else {
            listEl.innerHTML = recommendations.slice(0, 5).map(type => `
                <div class="border border-notion-border rounded-lg p-4 hover:bg-notion-sidebar transition-colors">
                    <h4 class="font-semibold text-lg text-notion-text mb-2">${type.name}</h4>
                    <p class="text-sm text-notion-textLight mb-2"><strong>핵심 기능:</strong> ${type.core_features.join(', ')}</p>
                    <div class="flex gap-4 text-sm">
                        <span class="px-2 py-1 bg-red-100 text-red-700 rounded">난이도: ${type.avg_difficulty.toFixed(2)}</span>
                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded">시장성: ${type.avg_marketability.toFixed(2)}</span>
                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded">화면: ${type.mvp_screens}개</span>
                        <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded">기간: ${type.build_time}</span>
                    </div>
                </div>
            `).join('');
        }
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
});
</script>
{% endblock %}
